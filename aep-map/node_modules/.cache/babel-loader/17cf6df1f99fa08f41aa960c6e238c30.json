{"ast":null,"code":"import Style from 'ol/style/Style';\nimport Stroke from 'ol/style/Stroke';\nimport Fill from 'ol/style/Fill';\nimport Text from 'ol/style/Text';\nimport VectorLayer from 'ol/layer/Vector';\nimport VectorSource from 'ol/source/Vector';\nimport GeoJSON from 'ol/format/GeoJSON';\nconst ML_INITALIZE_START = 'ML_INITALIZE_START';\nconst ML_INITALIZE_END = 'ML_INITALIZE_END';\nconst MAP_INITIALIZED = 'MAP_INITIALIZED';\nconst apiHost = process.env.REACT_APP_APIHOST_ML;\n\nconst getBundle = function () {\n  return {\n    name: 'ml',\n    getReducer: () => {\n      const initialData = {\n        _shouldInitialize: false\n      };\n      return (state = initialData, {\n        type,\n        payload\n      }) => {\n        switch (type) {\n          case ML_INITALIZE_START:\n          case ML_INITALIZE_END:\n            return Object.assign({}, state, payload);\n\n          case MAP_INITIALIZED:\n            return Object.assign({}, state, {\n              _shouldInitialize: true\n            });\n\n          default:\n            return state;\n        }\n      };\n    },\n    doMlInitialize: () => ({\n      dispatch,\n      store,\n      anonGet\n    }) => {\n      dispatch({\n        type: ML_INITALIZE_START,\n        payload: {\n          _shouldInitialize: false\n        }\n      });\n      initMap(store);\n    },\n    reactMlShouldInitialize: state => {\n      if (state.ml._shouldInitialize) return {\n        actionCreator: \"doMlInitialize\"\n      };\n    }\n  };\n};\n\nexport { getBundle as default };\n\nconst initMap = function (store) {\n  const map = store.selectMap();\n  const root = store.selectTreeRootNode();\n  const token = \"eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMzg2OTUxMjQ4Iiwicm9sZXMiOlsiQVBQLlNZU0FETUlOIiwiQVBQLlBVQkxJQyIsIkFQUC5QVUJMSUMiXSwiYXVkIjpbIjllZGRiZTYzLWM1MjItNDZkNS05ZGU3LWU5YWZkZjRlN2I0ZiJdLCJpYXQiOjE1OTc0MTU2MjUsImV4cCI6MTU5NzUwMjAyNSwibmFtZSI6IkdPU1MuUkFOREFMLlMuIn0.nrYaQjEsdTGyVqk3Nt3gLbGHkPYX2aEcXMIkXQ17-u-Ce6rjrUEN7i3AmcxbKu337AtkUsHhnXDnwAANB13a61n7VyMW39elscKFhIycGrNq8CV8KhfHu59mM0G8InIWRdBrfnNOlVv-3H7KcrIsQjga8jzv0KXtZR0QaCoqq5ixEZszmxaQH-jsbuCxVMz3CtA1x-pOjbT_JDKoq92qLGkWTuHpIPNQL6vZ5gWs47yCHN2kQ5Tao44GeEqS2hS1hVwdJEbQEm2y_eKSeFgKW9rd-7UN7TfCvJW-YeLWJ6digTakIdF1mnnzq6Mn61abSZUYxW0LhvvqoEvwF6H51w\";\n  let vectorSource = new VectorSource({\n    format: new GeoJSON({\n      featureProjection: \"EPSG:3857\"\n    }),\n    loader: function (extent, resolution, projection) {\n      //let token=\"\";\n      //const pp=store.selectParentProps();\n      //if(store.selectParentProps()){\n      //  token=store.selectParentProps().authToken;\n      //}\n      var url = `${apiHost}/models/boundaries`;\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', url);\n      xhr.setRequestHeader(\"Authorization\", `Bearer ${token}`); //var onError = function() {\n      //  vectorSource.removeLoadedExtent(extent);\n      //}\n      //xhr.onerror = onError;\n\n      xhr.onload = function () {\n        if (xhr.status == 200) {\n          let format = vectorSource.getFormat();\n          let features = format.readFeatures(xhr.responseText);\n          vectorSource.addFeatures(features);\n        } else {\n          //onError();\n          console.log(\"ERROR LOADING VECTOR SOURCE\");\n        }\n      };\n\n      xhr.send();\n    }\n  });\n  var vectorLayer1 = new VectorLayer({\n    source: vectorSource,\n    style: function (feature) {\n      let s = new Style({\n        stroke: new Stroke({\n          color: '#CCC',\n          width: 2.0\n        }),\n        fill: new Fill({\n          color: 'rgba(0,0,255,0.5)'\n        }),\n        text: new Text({\n          font: '11px \"Open Sans\", \"Arial Unicode MS\", \"sans-serif\"',\n          //placement: 'line',\n          overflow: false,\n          stroke: new Stroke({\n            color: \"#FFF\",\n            width: 2\n          }),\n          fill: new Fill({\n            color: 'black'\n          })\n        })\n      });\n      s.getText().setText(feature.get('modelName'));\n      return s;\n    }\n  });\n  store.doAddLayer({\n    mapLayer: vectorLayer1,\n    displayName: \"Model Boundaries\",\n    type: \"notfolder\",\n    parentUid: root.uid,\n    visible: true\n  });\n  vectorLayer1.getSource().on('change', function (event) {\n    if (vectorLayer1.getSource().getState() === 'ready') {\n      map.on('click', function (evt) {\n        console.log(evt.pixel);\n      });\n      map.on('pointermove', function (evt) {\n        if (evt.dragging) {\n          return;\n        }\n\n        console.log(evt);\n      });\n    }\n  });\n};","map":{"version":3,"sources":["C:/Examples/aepmap/aep-map/src/cm3-plugins/ml/cm3-ml-bundle.js"],"names":["Style","Stroke","Fill","Text","VectorLayer","VectorSource","GeoJSON","ML_INITALIZE_START","ML_INITALIZE_END","MAP_INITIALIZED","apiHost","process","env","REACT_APP_APIHOST_ML","getBundle","name","getReducer","initialData","_shouldInitialize","state","type","payload","Object","assign","doMlInitialize","dispatch","store","anonGet","initMap","reactMlShouldInitialize","ml","actionCreator","default","map","selectMap","root","selectTreeRootNode","token","vectorSource","format","featureProjection","loader","extent","resolution","projection","url","xhr","XMLHttpRequest","open","setRequestHeader","onload","status","getFormat","features","readFeatures","responseText","addFeatures","console","log","send","vectorLayer1","source","style","feature","s","stroke","color","width","fill","text","font","overflow","getText","setText","get","doAddLayer","mapLayer","displayName","parentUid","uid","visible","getSource","on","event","getState","evt","pixel","dragging"],"mappings":"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","sourcesContent":["import Style from 'ol/style/Style';\r\nimport Stroke from 'ol/style/Stroke';\r\nimport Fill from 'ol/style/Fill';\r\nimport Text from 'ol/style/Text';\r\nimport VectorLayer from 'ol/layer/Vector';\r\nimport VectorSource from 'ol/source/Vector';\r\n\r\nimport GeoJSON from 'ol/format/GeoJSON';\r\nconst ML_INITALIZE_START='ML_INITALIZE_START';\r\nconst ML_INITALIZE_END='ML_INITALIZE_END';\r\nconst MAP_INITIALIZED='MAP_INITIALIZED';\r\n\r\nconst apiHost=process.env.REACT_APP_APIHOST_ML\r\n\r\nconst getBundle=function(){\r\n  return({\r\n    name:'ml',\r\n    getReducer: () => {\r\n      const initialData = {\r\n        _shouldInitialize: false,\r\n      };\r\n      return (state = initialData, { type, payload }) => {\r\n        switch(type){\r\n          case ML_INITALIZE_START:\r\n          case ML_INITALIZE_END:\r\n            return Object.assign({}, state, payload);\r\n          case MAP_INITIALIZED:\r\n            return Object.assign({}, state, {\r\n              _shouldInitialize: true\r\n            })\r\n          default:\r\n            return state;\r\n        }\r\n      }\r\n    },\r\n    doMlInitialize: () => ({ dispatch, store, anonGet }) => {\r\n      dispatch({\r\n        type: ML_INITALIZE_START,\r\n        payload: {\r\n          _shouldInitialize: false,\r\n        }\r\n      })\r\n      initMap(store);      \r\n    },\r\n    reactMlShouldInitialize: (state) => {\r\n      if(state.ml._shouldInitialize) return { actionCreator: \"doMlInitialize\" };\r\n    }\r\n  })\r\n}\r\n\r\nexport {getBundle as default}\r\n\r\n\r\nconst initMap=function(store){\r\n  const map = store.selectMap();\r\n      const root = store.selectTreeRootNode();\r\n      const token = \"eyJhbGciOiJSUzUxMiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMzg2OTUxMjQ4Iiwicm9sZXMiOlsiQVBQLlNZU0FETUlOIiwiQVBQLlBVQkxJQyIsIkFQUC5QVUJMSUMiXSwiYXVkIjpbIjllZGRiZTYzLWM1MjItNDZkNS05ZGU3LWU5YWZkZjRlN2I0ZiJdLCJpYXQiOjE1OTc0MTU2MjUsImV4cCI6MTU5NzUwMjAyNSwibmFtZSI6IkdPU1MuUkFOREFMLlMuIn0.nrYaQjEsdTGyVqk3Nt3gLbGHkPYX2aEcXMIkXQ17-u-Ce6rjrUEN7i3AmcxbKu337AtkUsHhnXDnwAANB13a61n7VyMW39elscKFhIycGrNq8CV8KhfHu59mM0G8InIWRdBrfnNOlVv-3H7KcrIsQjga8jzv0KXtZR0QaCoqq5ixEZszmxaQH-jsbuCxVMz3CtA1x-pOjbT_JDKoq92qLGkWTuHpIPNQL6vZ5gWs47yCHN2kQ5Tao44GeEqS2hS1hVwdJEbQEm2y_eKSeFgKW9rd-7UN7TfCvJW-YeLWJ6digTakIdF1mnnzq6Mn61abSZUYxW0LhvvqoEvwF6H51w\"\r\n      let vectorSource=new VectorSource({\r\n        format: new GeoJSON({featureProjection:\"EPSG:3857\"}),\r\n        loader:function(extent, resolution, projection) {\r\n          //let token=\"\";\r\n          //const pp=store.selectParentProps();\r\n          //if(store.selectParentProps()){\r\n          //  token=store.selectParentProps().authToken;\r\n          //}\r\n          var url = `${apiHost}/models/boundaries`;\r\n          var xhr = new XMLHttpRequest();\r\n          xhr.open('GET', url);\r\n          xhr.setRequestHeader(\"Authorization\", `Bearer ${token}`)\r\n          //var onError = function() {\r\n          //  vectorSource.removeLoadedExtent(extent);\r\n          //}\r\n          //xhr.onerror = onError;\r\n          xhr.onload = function() {\r\n            if (xhr.status == 200) {\r\n              let format=vectorSource.getFormat();\r\n              let features = format.readFeatures(xhr.responseText)\r\n              vectorSource.addFeatures(features);\r\n            } else {\r\n              //onError();\r\n              console.log(\"ERROR LOADING VECTOR SOURCE\")\r\n            }\r\n          }\r\n          xhr.send();\r\n        }\r\n      });\r\n\r\n      var vectorLayer1 = new VectorLayer({\r\n          source:vectorSource,\r\n          style:function(feature){\r\n            let s = new Style({\r\n              stroke: new Stroke({\r\n                color: '#CCC',\r\n                width: 2.0\r\n              }),\r\n              fill:new Fill({\r\n                color: 'rgba(0,0,255,0.5)'\r\n              }),\r\n              text: new Text({\r\n                font: '11px \"Open Sans\", \"Arial Unicode MS\", \"sans-serif\"',\r\n                //placement: 'line',\r\n                overflow:false,\r\n                stroke: new Stroke({color:\"#FFF\", width:2}),\r\n                fill: new Fill({\r\n                  color: 'black'\r\n                })\r\n              })\r\n            })\r\n            s.getText().setText(feature.get('modelName'));\r\n            return s;\r\n          } \r\n      });\r\n   \r\n      store.doAddLayer({\r\n          mapLayer:vectorLayer1,\r\n          displayName:\"Model Boundaries\",\r\n          type:\"notfolder\",\r\n          parentUid:root.uid,\r\n          visible:true,\r\n      })\r\n      vectorLayer1.getSource().on('change', function(event) {\r\n        if(vectorLayer1.getSource().getState()==='ready'){\r\n\r\n          map.on('click',function(evt) {\r\n            console.log(evt.pixel)\r\n          })\r\n\r\n          map.on('pointermove', function(evt) {\r\n            if (evt.dragging) {\r\n              return;\r\n            }\r\n            console.log(evt)\r\n          })\r\n        }\r\n      });\r\n}"]},"metadata":{},"sourceType":"module"}